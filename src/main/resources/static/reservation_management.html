<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reservations Management</title>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>

<body>
<div class="container mt-5">
  <h2>Reservations</h2>
  <table class="table">
    <thead>
    <tr>
      <th>Reservation ID</th>
      <th>Spot Location</th>
      <th>User ID</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Actions</th>
    </tr>
    </thead>
    <tbody id="reservationsTable">
    <!-- Reservations will be appended here -->
    </tbody>
  </table>
</div>
<script>
  $(document).ready(function () {
    // Fetch all reservations and display them in the table
    function fetchReservations() {
      axios.get('/getAllReservations').then(response => {
        const reservations = response.data;
        $('#reservationsTable').empty(); // Clear existing rows

        reservations.forEach(reservation => {
          axios.get('/findSpotById', {
            params: {
              id: reservation.spotId
            }
          }).then(response => {
            const spot = response.data;
            const row = `
                        <tr>
                            <td>${reservation.reservationId}</td>
                            <td>${spot.location}</td>
                            <td>${reservation.userId}</td>
                            <td>${reservation.startTime}</td>
                            <td>${reservation.endTime}</td>
                            <td><button class="btn btn-danger delete-btn" data-id="${reservation.reservationId}">Delete</button></td>
                        </tr>
                    `;
            $('#reservationsTable').append(row);
          });
        });
      });
    }

    fetchReservations();

    // Delete reservation
    $(document).on('click', '.delete-btn', function () {
      const reservationId = $(this).data('id');
      axios.post('/deleteReservation', {}, {
        params: {
          reservationId: reservationId
        }
      }).then(() => {
        alert('Reservation deleted successfully!');
        fetchReservations(); // Refresh reservations
      }).catch(error => {
        alert('Failed to delete reservation: ' + error.message);
      });
    });
  });

</script>
</body>

</html>
